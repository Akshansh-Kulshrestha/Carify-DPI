{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vehicle Inspection Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .navbar-brand img {
      max-width: 140px;
    }
    .summary-card h6 {
      font-size: 14px;
    }
    @media (max-width: 576px) {
      .summary-card h6 {
        font-size: 12px;
      }
      .navbar-brand img {
        max-width: 100px;
      }
      .landing-header h2 {
        font-size: 16px !important;
      }
      .btn {
        font-size: 12px !important;
        padding: 5px 10px !important;
      }
    }
  </style>
</head>
<body>

<!-- Header -->
<header class="landing-header ">
  <div class="container-fluid p-0">
    <div class="row align-items-center m-0">
      <div class="col-12 p-0">
        <nav class="navbar navbar-expand-lg navbar-light p-0" style="height: auto;">
          <div class="container-fluid px-3 py-2">
            <a class="navbar-brand" href="#">
              <img src="{% static 'images/carify-logo.png' %}" alt="Logo">
            </a>

            <div style="flex-grow: 1; position: relative; height: 100%;">
              <div style="position: absolute; top: 0; left: 0; width: 150%; height: 100%; background-color: #F04C5C; transform: skewX(-0.06turn); transform-origin: bottom left; z-index: 0;"></div>

              <div class="d-flex justify-content-between align-items-center w-100 px-3" style="position: relative; z-index: 1;">
                <h2 class="m-0 text-white text-center flex-grow-1">Vehicle DPI Form</h2>
                <a class="btn btn-outline-light ms-3" href="{% url 'admin_dashboard' %}">Go Back</a>
              </div>
            </div>
          </div>
        </nav>
      </div>
    </div>
  </div>
</header>

<div class="container py-4">
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="accordion" id="formAccordion">
      {% for name, form_instance in all_forms.items %}
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading{{ forloop.counter }}">
          <button class="accordion-button {% if name != current_form %}collapsed{% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}" aria-expanded="{% if name == current_form %}true{% else %}false{% endif %}">
            {{ name|capfirst }}
          </button>
        </h2>
        <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse {% if name == current_form %}show{% endif %}" data-bs-parent="#formAccordion">
          <div class="accordion-body">
            {% if name == current_form %}
              {% for field in form_instance %}
              <div class="mb-3">
                <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}{% if field.field.required %}*{% endif %}</label>
                {{ field }}
                {% if field.help_text %}
                  <div class="form-text">{{ field.help_text }}</div>
                {% endif %}
                {% if field.errors %}
                  <div class="text-danger">{{ field.errors }}</div>
                {% endif %}
              </div>

              {% if field.name == "image" %}
              <div class="mb-3">
                <label class="form-label">Image Preview:</label><br>
                <img id="imagePreview" class="preview-img" src="#" alt="No image selected" style="display:none;" />
              </div>
              <script>
                document.addEventListener("DOMContentLoaded", function () {
                  const imageField = document.querySelector('[name="{{ field.html_name }}"]');
                  const preview = document.getElementById("imagePreview");
                  if (imageField) {
                    imageField.addEventListener("change", function (event) {
                      const file = event.target.files[0];
                      if (file) {
                        preview.src = URL.createObjectURL(file);
                        preview.style.display = 'block';
                      } else {
                        preview.style.display = 'none';
                      }
                    });
                  }
                });
              </script>
              {% endif %}
              {% endfor %}

              <div class="d-flex flex-column flex-md-row justify-content-between mt-4 gap-2">
                {% if name != form_names.0 %}
                  <button type="submit" name="navigate_previous" value="{{ current_form }}" class="btn btn-secondary w-100 w-md-auto">Previous</button>
                {% endif %}

                {% if name != form_names|last %}
                  <button type="submit" name="save_section" value="{{ current_form }}" class="btn btn-primary w-100 w-md-auto">Next</button>
                {% else %}
                  <button type="submit" name="save_section" value="{{ current_form }}" class="btn btn-success w-100 w-md-auto">Save & Finish</button>
                {% endif %}
              </div>
            {% else %}
              <p class="text-muted">This section will be editable when selected.</p>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
